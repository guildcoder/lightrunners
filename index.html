<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L I G H T R U N N E R S</title>
<style>
html, body { margin:0; padding:0; overflow:hidden; background:black; font-family:sans-serif;}
canvas { display:block; background:#0f0f0f; }

.menu, .pauseMenu {
  position:absolute; top:0; left:0; width:100%; height:100%;
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  background:rgba(0,0,0,0.85); color:white; z-index:10;
}
.menu h1 { font-size:48px; color:#0ff; text-shadow:0 0 10px #0ff,0 0 20px #0ff; margin-bottom:40px; }
.menu button { margin:10px; padding:15px 40px; font-size:20px; color:#0ff; background:none; border:2px solid #0ff; border-radius:10px; cursor:pointer; text-shadow:0 0 5px #0ff;}
.menu button:hover { background:#0ff1; color:black; }
.menu input { margin:5px; padding:5px; border-radius:5px; border:1px solid #0ff; background:black; color:#0ff; text-align:center; }

.pauseMenu { display:none; flex-direction:column; text-align:center; }

.mobileControls {
  position:absolute; bottom:20px; left:0; width:100%; display:flex; justify-content:space-around; z-index:9;
}
.mobileControls button {
  width:60px; height:60px; font-size:20px; border-radius:50%; border:none;
  background:rgba(0,255,255,0.2); color:#0ff; backdrop-filter:blur(5px);
}
.mobileControls button:active { background:rgba(0,255,255,0.5); }
</style>
</head>
<body>

<div class="menu" id="mainMenu">
  <h1>L I G H T R U N N E R S</h1>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="pin" placeholder="PIN">
  <label>Color 1: <input type="color" id="color1" value="#00ffff"></label>
  <label>Color 2: <input type="color" id="color2" value="#ff00ff"></label>
  <button id="loginBtn">Register / Login</button>
  <button id="playBtn">Play</button>
</div>

<div class="pauseMenu" id="pauseMenu">
  <h2>PAUSED</h2>
  <p>Controls:</p>
  <p>WASD / Arrows: Move</p>
  <p>R: Get In/Out of Bike</p>
  <p>Space: Fire (desktop)</p>
  <button id="resumeBtn">Resume</button>
  <button id="quitBtn">Quit to Main Menu</button>
</div>

<canvas id="gameCanvas" width="900" height="600"></canvas>

<!-- Mobile Controls -->
<div class="mobileControls" id="mobileControls" style="display:none;">
  <button id="upBtn">↑</button>
  <button id="leftBtn">←</button>
  <button id="downBtn">↓</button>
  <button id="rightBtn">→</button>
  <button id="bikeBtn">R</button>
  <button id="fireBtn">•</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const mainMenu = document.getElementById('mainMenu');
const pauseMenu = document.getElementById('pauseMenu');
const mobileControls = document.getElementById('mobileControls');

const loginBtn = document.getElementById('loginBtn');
const playBtn = document.getElementById('playBtn');
const resumeBtn = document.getElementById('resumeBtn');
const quitBtn = document.getElementById('quitBtn');

const usernameInput = document.getElementById('username');
const pinInput = document.getElementById('pin');
const color1Input = document.getElementById('color1');
const color2Input = document.getElementById('color2');

let paused = false;
let keys = {};
let isMobile = /Mobi|Android/i.test(navigator.userAgent);

if(isMobile) mobileControls.style.display = 'flex';

document.addEventListener('keydown', e=>{ keys[e.key.toLowerCase()]=true; });
document.addEventListener('keyup', e=>{ keys[e.key.toLowerCase()]=false; });

document.addEventListener('keydown', e=>{
  if(e.key==='Escape') togglePause();
  if(e.key.toLowerCase()==='r') toggleBike();
});

function setupMobileButtons(){
  document.getElementById('upBtn').addEventListener('touchstart',()=>keys['w']=true);
  document.getElementById('upBtn').addEventListener('touchend',()=>keys['w']=false);
  document.getElementById('downBtn').addEventListener('touchstart',()=>keys['s']=true);
  document.getElementById('downBtn').addEventListener('touchend',()=>keys['s']=false);
  document.getElementById('leftBtn').addEventListener('touchstart',()=>keys['a']=true);
  document.getElementById('leftBtn').addEventListener('touchend',()=>keys['a']=false);
  document.getElementById('rightBtn').addEventListener('touchstart',()=>keys['d']=true);
  document.getElementById('rightBtn').addEventListener('touchend',()=>keys['d']=false);
  document.getElementById('bikeBtn').addEventListener('touchstart',toggleBike);
  // Fire button can be implemented later
}
if(isMobile) setupMobileButtons();

const player = { x:500, y:500, size:20, speed:2, onBike:false, direction:-Math.PI/2, alive:true, colors:['#00ffff','#ff00ff'] };
const bike = { x:500, y:500, width:40, height:20, speed:5, trail:[], mounted:false };
const bots = [];
const copBikes = [];

function randomColor(){ const c=['#ff00ff','#0ff','#ff0','#f0f','#0f0','#f00','#0ff','#0f0']; return c[Math.floor(Math.random()*c.length)]; }
function randomName(){ const n=['ByteRider','NeonPulse','GlitchShadow','LaserFang','CyberStorm','ElectroVex','DataPhantom','SynthWave','PixelKnight','QuantumFlux','BuzzCore']; return n[Math.floor(Math.random()*n.length)]; }

function spawnBot(x,y){
  bots.push({
    x:x, y:y, width:20, height:30,
    vx:(Math.random()*2-1)*1.5, vy:(Math.random()*2-1)*1.5,
    name: randomName(),
    bike:{mounted:false,width:40,height:20,trail:[],colors:[randomColor(),randomColor()]},
    state:'neutral'
  });
}
for(let i=0;i<10;i++) spawnBot(Math.random()*1000,Math.random()*1000);

loginBtn.addEventListener('click',()=>{
  const username=usernameInput.value;
  const pin=pinInput.value;
  if(!username||!pin){ alert('Enter username & PIN'); return; }
  player.colors[0]=color1Input.value;
  player.colors[1]=color2Input.value;
  localStorage.setItem('lr_username',username);
  localStorage.setItem('lr_pin',pin);
  localStorage.setItem('lr_color1',player.colors[0]);
  localStorage.setItem('lr_color2',player.colors[1]);
  alert('Registered / logged in as '+username);
});

playBtn.addEventListener('click',()=>{
  const savedUsername = localStorage.getItem('lr_username');
  const savedPin = localStorage.getItem('lr_pin');
  if(!savedUsername||!savedPin){ alert('Please register first'); return; }
  player.colors[0]=localStorage.getItem('lr_color1')||player.colors[0];
  player.colors[1]=localStorage.getItem('lr_color2')||player.colors[1];
  mainMenu.style.display='none';
  startGame();
});

resumeBtn.addEventListener('click',()=>{ paused=false; pauseMenu.style.display='none'; });
quitBtn.addEventListener('click',()=>{ paused=false; pauseMenu.style.display='none'; mainMenu.style.display='flex'; resetGame(); });

function togglePause(){ paused=!paused; pauseMenu.style.display=paused?'flex':'none'; }
function toggleBike(){ if(!player.alive) return; player.onBike=!player.onBike; bike.mounted=player.onBike; if(bike.mounted){ bike.x=player.x; bike.y=player.y; bike.trail=[]; } }

function resetGame(){
  player.x=500; player.y=500; player.alive=true; player.onBike=false; bike.mounted=false; bike.trail=[];
  bots.length=0; copBikes.length=0; for(let i=0;i<10;i++) spawnBot(Math.random()*1000,Math.random()*1000);
}

function drawGrid(camX,camY){
  const gridSize=50; ctx.strokeStyle='rgba(0,255,255,0.1)'; ctx.lineWidth=1;
  for(let x=-camX%gridSize;x<canvas.width;x+=gridSize){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke(); }
  for(let y=-camY%gridSize;y<canvas.height;y+=gridSize){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke(); }
}

function updatePlayer(){
  if(!player.alive||paused) return;
  const spd=player.onBike?bike.speed:player.speed;
  if(keys['w']||keys['arrowup']){ player.y-=spd; player.direction=-Math.PI/2; }
  if(keys['s']||keys['arrowdown']){ player.y+=spd; player.direction=Math.PI/2; }
  if(keys['a']||keys['arrowleft']){ player.x-=spd; player.direction=Math.PI; }
  if(keys['d']||keys['arrowright']){ player.x+=spd; player.direction=0; }

  if(player.onBike){
    bike.x=player.x; bike.y=player.y;
    bike.trail.push({x:bike.x, y:bike.y, time:Date.now()});
    bike.trail=bike.trail.filter(t=>Date.now()-t.time<3000);
  }
}

function updateBots(){
  bots.forEach(bot=>{
    bot.x+=bot.vx; bot.y+=bot.vy;
    if(bot.x<0||bot.x+bot.width>2000) bot.vx*=-1;
    if(bot.y<0||bot.y+bot.height>2000) bot.vy*=-1;
    if(!bot.bike.mounted && Math.random()<0.001){ bot.bike.mounted=true; bot.bike.x=bot.x; bot.bike.y=bot.y; bot.bike.trail=[]; }
    if(bot.bike.mounted){
      bot.bike.x=bot.x; bot.bike.y=bot.y;
      bot.bike.trail.push({x:bot.bike.x, y:bot.bike.y, time:Date.now()});
      bot.bike.trail = bot.bike.trail.filter(t=>Date.now()-t.time<3000);
    }
  });
}

function spawnCopBike(x,y){
  copBikes.push({x:x,y:y,width:40,height:20,speed:3,trail:[],colors:['#00f','#f00']});
}

function updateCops(){
  copBikes.forEach(cop=>{
    const dx = player.x - cop.x;
    const dy = player.y - cop.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    const speed = cop.speed;
    if(dist > 1){
      cop.x += (dx/dist)*speed;
      cop.y += (dy/dist)*speed;
      cop.trail.push({x:cop.x, y:cop.y, time:Date.now()});
      cop.trail = cop.trail.filter(t=>Date.now()-t.time<3000);
    }
  });
}

function checkCollisions(){
  bots.forEach(bot=>{
    if(bot.bike.mounted && player.onBike){
      if(player.x+bike.width/2>bot.bike.x && player.x-bike.width/2<bot.bike.x+bot.bike.width &&
         player.y+bike.height/2>bot.bike.y && player.y-bike.height/2<bot.bike.y+bot.bike.height){
        player.alive=false; spawnCopBike(bot.bike.x,bot.bike.y); setTimeout(resetGame,1000);
      }
    }
  });
}

function checkTrailCollisions(){
  if(!player.alive || !player.onBike) return;

  // Cop trails
  copBikes.forEach(cop=>{
    cop.trail.forEach(t=>{
      if(Math.abs(player.x - t.x) < 10 && Math.abs(player.y - t.y) < 10){
        player.alive = false; setTimeout(resetGame,1000);
      }
    });
  });

  // Bot trails
  bots.forEach(bot=>{
    if(bot.bike.mounted){
      bot.bike.trail.forEach(t=>{
        if(Math.abs(player.x - t.x) < 10 && Math.abs(player.y - t.y) < 10){
          player.alive = false; spawnCopBike(bot.bike.x,bot.bike.y); setTimeout(resetGame,1000);
        }
      });
    }
  });

  // Player own trail
  bike.trail.forEach((t,i)=>{
    if(Math.abs(player.x - t.x) < 10 && Math.abs(player.y - t.y) < 10 && i < bike.trail.length - 5){
      player.alive = false; setTimeout(resetGame,1000);
    }
  });
}

function drawCopBike(cop,camX,camY){
  const t=(Math.sin(Date.now()/200)*0.5+0.5);
  const grad=ctx.createLinearGradient(cop.x-camX,cop.y-camY,cop.x+cop.width-camX,cop.y+cop.height-camY);
  grad.addColorStop(0, `rgba(${Math.floor(255*t)},0,255,1)`);
  grad.addColorStop(1, `rgba(0,${Math.floor(255*(1-t))},255,1)`);
  ctx.fillStyle=grad; ctx.fillRect(cop.x-camX,cop.y-camY,cop.width,cop.height);
  cop.trail.forEach(tl=>{
    const age=(Date.now()-tl.time)/3000; if(age>1) return;
    ctx.fillStyle=`rgba(0,0,255,${1-age})`;
    ctx.fillRect(tl.x-camX-5,tl.y-camY-5,10,10);
  });
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const camX=player.x-canvas.width/2;
  const camY=player.y-canvas.height/2;
  drawGrid(camX,camY);

  // Player
  if(player.alive){
    ctx.fillStyle=player.colors[0];
    ctx.fillRect(player.x-20-camX,player.y-20-camY,40,40);
  }
  if(player.onBike){
    bike.trail.forEach(t=>{
      const age=(Date.now()-t.time)/3000;
      ctx.fillStyle=player.colors[0]; ctx.globalAlpha=1-age;
      ctx.fillRect(t.x-camX-5, t.y-camY-5, 10, 10);
      ctx.globalAlpha=1;
    });
    ctx.fillStyle = player.colors[0];
    ctx.fillRect(bike.x-camX-bike.width/2, bike.y-camY-bike.height/2, bike.width, bike.height);
  }

  // Bots
  bots.forEach(bot=>{
    if(!bot.bike.mounted){
      ctx.fillStyle='white'; ctx.fillRect(bot.x-camX,bot.y-camY,bot.width,bot.height);
      ctx.fillStyle='white'; ctx.font='12px monospace'; ctx.fillText(bot.name, bot.x-camX, bot.y-10-camY);
    } else {
      bot.bike.trail.forEach(t=>{
        const age=(Date.now()-t.time)/3000; if(age>1) return;
        ctx.fillStyle=bot.bike.colors[0]; ctx.globalAlpha=1-age;
        ctx.fillRect(t.x-camX-5,t.y-camY-5,10,10); ctx.globalAlpha=1;
      });
      ctx.fillStyle = bot.bike.colors[0];
      ctx.fillRect(bot.bike.x-camX, bot.bike.y-camY, bot.bike.width, bot.bike.height);
    }
  });

  // Cop bikes
  copBikes.forEach(cop=>{
    drawCopBike(cop,camX,camY);
  });
}

function gameLoop(){ 
  if(!paused){
    updatePlayer();
    updateBots();
    updateCops();
    checkCollisions();
    checkTrailCollisions();
  }
  draw(); 
  requestAnimationFrame(gameLoop); 
}

function startGame(){ gameLoop(); }
</script>
</body>
</html>
